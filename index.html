<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Earth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --green: #15803D;
            --yellow: #FACC15;
            --banner-bg: #CFF0DC;
            --dark-text: #1F2937;
            --form-section-bg: #166534;
            --footer-bg: #14532D;
        }

        .line-clamp-4 {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-card {
            border-radius: 0.75rem;
            box-shadow: 0 8px 20px rgba(2, 6, 23, 0.06);
            transition: transform 0.18s ease-in-out, box-shadow 0.18s;
            border: 1px solid #E6F4EA;
            background: white;
        }

        .product-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 30px rgba(2, 6, 23, 0.10);
        }

        .add-to-cart-btn {
            background-color: var(--green);
            color: white;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            font-weight: 600;
            border-radius: 0.5rem;
            width: 100%;
            font-size: 0.9rem;
        }

        .add-to-cart-btn:hover {
            background-color: var(--green);
        }

        .category-button {
            color: var(--dark-text);
        }

        .category-button:hover {
            background-color: #E6F4EA;
            color: var(--dark-text);
        }

        .product-grid {
            grid-template-columns: repeat(1, minmax(0, 1fr));
            gap: 1.25rem;
            justify-items: center;
        }

        @media (min-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        @media (min-width: 1024px) {
            .shop-grid {
                grid-template-columns: 240px 1fr 250px !important;
            }

            .cart-container {
                display: block !important;
            }

            .fixed-cart {
                display: none !important;
            }
        }

        .full-bleed {
            width: 100%;
            margin-left: calc(50% - 50vw);
            margin-right: calc(50% - 50vw);
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .form-input-field {
            background-color: white;
            border: 1px solid var(--green);
            border-radius: 0.5rem;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            width: 100%;
        }

        .form-input-field::placeholder {
            color: #6B7280;
        }

        .fixed-cart {
            position: fixed;
            right: 1rem;
            bottom: 1rem;
            width: 20rem;
            background-color: white;
            border-radius: 0.75rem;
            padding: 0.75rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            z-index: 80;
            display: none;
        }

        @media (max-width: 1023px) {
            .fixed-cart {
                display: block;
            }
        }

        .backdrop-show {
            display: flex !important;
        }

        .modal-detail-close-btn {
            background-color: transparent !important;
            color: red !important;
            border: none !important;
            padding: 0 !important;
            margin-left: auto font-size: 1.5rem line-height: 1;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-header-close-btn {
            color: red !important;
            font-size: 1.5rem;
            line-height: 1;
        }
    </style>

</head>

<body class="bg-slate-50 text-slate-800">
    <header class="sticky top-0 z-40 shadow-sm" style="background-color: var(--green);">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between flex-wrap">
            <div class="flex items-center gap-3 flex-none">
                <div class="text-white text-xl font-extrabold">🌱 Green Earth</div>
            </div>

            <nav class="hidden md:flex gap-8 items-center justify-center w-2/4">
                <a href="#about" class="text-white font-medium">About</a>
                <a href="#shop" class="text-white font-medium">Gallery</a>
                <a href="#impact" class="text-white font-medium">Our Impact</a>
            </nav>

            <div class="flex items-center justify-end w-1/4">
                <button onclick="document.getElementById('form-section').scrollIntoView({ behavior: 'smooth' })"
                    class="bg-[var(--yellow)] text-[var(--green)] font-bold px-4 py-2 rounded-full shadow hidden md:inline-flex">
                    Plant a Tree
                </button>

                </button>
                <div class="md:hidden ml-4">
                    <button id="mobileMenuBtn" class="text-white font-semibold">Menu</button>
                </div>
            </div>
        </div>

        <div id="mobileMenu" class="hidden md:hidden border-t" style="background-color: var(--green);">
            <div class="px-4 py-3 flex flex-col gap-2">
                <a href="#about" class="text-white font-semibold">About</a>
                <a href="#shop" class="text-white font-semibold">Gallery</a>
                <a href="#impact" class="text-white font-semibold">Our Impact</a>
                <button onclick="document.getElementById('form-section').scrollIntoView({ behavior: 'smooth' })"
                    class="mt-2 bg-[var(--yellow)] text-[var(--green)] font-bold px-3 py-2 rounded-full">Plant a
                    Tree</button>
            </div>
        </div>
    </header>
    <section class="relative overflow-hidden mb-8" style="background-color: var(--banner-bg);">
        <div class="pointer-events-none absolute left-0 bottom-0 hidden md:block">
            <img src="assets/hero-leaf1.png" alt="leaf"
                class="w-[420px] h-[300px] object-contain opacity-95 hero-leaf1" />
        </div>
        <div class="pointer-events-none absolute right-0 bottom-0 hidden md:block">
            <img src="assets/hero-leaf2.png" alt="leaf"
                class="w-[420px] h-[300px] object-contain opacity-95 hero-leaf2" />
        </div>
        <div class="max-w-6xl mx-auto text-center px-4 py-[80px]">
            <h1 class="text-[36px] md:text-[44px] font-semibold text-[var(--dark-text)] leading-tight">Plant a Tree,
                Grow a Future</h1>
            <p class="mt-4 max-w-[900px] mx-auto text-[var(--dark-text)] opacity-80">
                Join our mission to plant 1 million trees and make the Earth greener for future <br>generations. </br>
            </p>
            <div class="mt-6">
                <button onclick="document.getElementById('shop').scrollIntoView({ behavior: 'smooth' })"
                    class="bg-[var(--yellow)] text-white px-6 py-3 rounded-lg font-semibold shadow">
                    Get Involved
                </button>
            </div>
        </div>
    </section>
    <main class="max-w-6xl mx-auto px-4 py-0">

        <section id="shop" class="mt-0">
            <h2 class="text-center text-[var(--dark-text)] font-semibold text-2xl mb-6">Choose Your Trees</h2>

            <div class="grid grid-cols-1 gap-6 shop-grid">
                <aside class="bg-white rounded-xl p-4 shadow">
                    <h4 class="text-[var(--dark-text)] font-semibold mb-3">Categories</h4>
                    <div id="category-list" class="flex flex-col gap-2"></div>
                </aside>

                <section>
                    <div id="spinner" class="hidden items-center justify-center p-10">
                        <svg class="w-10 h-10 animate-spin text-[var(--brand)]" viewBox="0 0 24 24" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-opacity="0.2" stroke-width="4">
                            </circle>
                            <path d="M22 12a10 10 0 0 1-10 10" stroke="currentColor" stroke-width="4"
                                stroke-linecap="round"></path>
                        </svg>
                        <span class="ml-3 text-slate-600 font-medium">Loading...</span>
                    </div>

                    <div id="products" class="grid product-grid"></div>
                </section>

                <div id="desktop-cart" class="hidden lg:block bg-white rounded-xl p-4 shadow cart-container">
                    <div class="font-bold">Your Cart <span id="cart-count-desktop"
                            class="text-sm text-slate-500">(0)</span></div>
                    <div id="cart-list-desktop" class="mt-3 max-h-96 overflow-auto text-sm text-slate-700">
                        <p class="text-slate-500">No items in cart</p>
                    </div>
                    <div class="mt-3 flex items-center justify-between font-extrabold">
                        <div>Total</div>
                        <div id="total-desktop">৳0</div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <section id="about" class="my-0 py-10">
        <div class="text-center mb-6">
            <h2 class="text-[var(--dark-text)] font-semibold text-2xl">About the Campaign</h2>
        </div>

        <div class="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
            <div>
                <img src="assets/about.png" alt="About" class="w-full rounded-xl shadow" />
            </div>
            <div>
                <p class="text-[var(--dark-text)] opacity-80 mb-4">
                    Green Earth is a global tree plantation initiative dedicated to fighting climate change. Since our
                    start, we’ve planted over 500,000 trees worldwide. By joining our campaign, you help restore
                    forests, create habitats for wildlife, and combat global warming.
                </p>
                <ul class="text-[var(--dark-text)] opacity-80 list-disc pl-5 space-y-2">
                    <li>Restoration of natural habitats</li>
                    <li>Improvement of air quality</li>
                    <li>Support for local communities</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="impact" class="mb-0 py-10 full-bleed" style="background-color: var(--banner-bg);">
        <div class="max-w-6xl mx-auto px-4">
            <h3 class="text-center text-[var(--dark-text)] font-semibold text-2xl mb-8">Our Impact</h3>

            <div class="w-full grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl p-6 text-center shadow-lg">
                    <div class="text-[var(--green)] font-extrabold text-3xl md:text-4xl lg:text-5xl">500K+</div>
                    <div class="mt-2 text-slate-700 text-sm md:text-base">Trees Planted</div>
                </div>
                <div class="bg-white rounded-xl p-6 text-center shadow-lg">
                    <div class="text-[var(--green)] font-extrabold text-3xl md:text-4xl lg:text-5xl">120+</div>
                    <div class="mt-2 text-slate-700 text-sm md:text-base">Communities Involved</div>
                </div>
                <div class="bg-white rounded-xl p-6 text-center shadow-lg">
                    <div class="text-[var(--green)] font-extrabold text-3xl md:text-4xl lg:text-5xl">30+</div>
                    <div class="mt-2 text-slate-700 text-sm md:text-base">Countries Reached</div>
                </div>
            </div>
        </div>
    </section>

    <section id="form-section" class="py-16 full-bleed" style="background-color: #166534;">
        <div class="max-w-xl mx-auto px-4">
            <h3 class="text-center text-white font-semibold text-2xl mb-8">Plant a Tree Today</h3>
            <div class="p-6 rounded-xl shadow-lg" style="background-color: var(--green);">
                <label for="donorName" class="font-semibold block mb-1 text-white sr-only">Your Name</label>
                <input id="donorName" class="form-input-field" placeholder="Your Name" />

                <label for="donorEmail" class="font-semibold block mb-1 text-white sr-only">Your Email Address</label>
                <input id="donorEmail" type="email" class="form-input-field" placeholder="Your Email Address" />

                <label for="donorQty" class="font-semibold block mb-1 text-white sr-only">Number of Trees</label>
                <select id="donorQty" class="form-input-field mb-6">
                    <option value="0">Number of Trees</option>
                    <option value="1">1 Tree</option>
                    <option value="5">5 Trees</option>
                    <option value="10">10 Trees</option>
                    <option value="20">20 Trees</option>
                    <option value="50">50 Trees</option>
                    <option value="100">100 Trees</option>
                    <option value="500">500 Trees</option>
                </select>

                <button id="donateBtn"
                    class="w-full bg-[var(--yellow)] text-white font-bold py-3 rounded-full text-lg shadow-lg">Donate
                    Now</button>
            </div>
        </div>
    </section>

    <div id="fixed-cart" class="fixed-cart" aria-live="polite">
        <div class="flex items-center justify-between mb-2">
            <div class="font-bold">Your Cart <span id="cart-count-mobile" class="text-sm text-slate-500">(0)</span>
            </div>
            <button id="closeFixedCartBtn" class="text-sm text-slate-600">Close</button>
        </div>
        <div id="cart-list-mobile" class="max-h-44 overflow-auto text-sm text-slate-700">
            <div class="text-slate-500">No items in cart</div>
        </div>
        <div class="mt-3 flex items-center justify-between font-extrabold">
            <div>Total</div>
            <div id="total-mobile">৳0</div>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black/60 items-center justify-center z-[100]">
        <div class="bg-white rounded-xl max-w-3xl w-[95%] md:w-3/4 p-6 relative">
            <button id="closeModalBtn" class="absolute top-4 right-4 modal-header-close-btn">
                <span class="text-xl font-bold">&times;</span>
            </button>
            <div id="modal-content"></div>
        </div>
    </div>

    <footer class="text-slate-100 py-6" style="background-color: var(--footer-bg);">
        <div class="max-w-full px-4 text-center">
            © 2025 Green Earth. All Rights Reserved.
        </div>
    </footer>
    <script>
        const API_BASE = 'https://openapi.programming-hero.com/api';
        const ENDPOINTS = {
            categories: API_BASE + '/categories',
            plants: API_BASE + '/plants',
            category: id => API_BASE + '/category/' + id,
            plant: id => API_BASE + '/plant/' + id
        };

        const categoryListEl = document.getElementById('category-list');
        const productsEl = document.getElementById('products');
        const spinnerEl = document.getElementById('spinner');
        const modalEl = document.getElementById('modal');
        const modalContentEl = document.getElementById('modal-content');
        const desktopCartEl = document.getElementById('desktop-cart');
        const cartListDesktopEl = document.getElementById('cart-list-desktop');
        const cartCountDesktopEl = document.getElementById('cart-count-desktop');
        const totalDesktopEl = document.getElementById('total-desktop');

        const cartListMobileEl = document.getElementById('cart-list-mobile');
        const cartCountMobileEl = document.getElementById('cart-count-mobile');
        const totalMobileEl = document.getElementById('total-mobile');

        const donateBtn = document.getElementById('donateBtn');
        const fixedCartEl = document.getElementById('fixed-cart');
        const closeFixedCartBtn = document.getElementById('closeFixedCartBtn');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const closeModalBtn = document.getElementById('closeModalBtn');


         let categories = [];
        let cart = [];

        const fmt = n => '৳' + Number(n).toFixed(2);
        const showSpinner = show => spinnerEl.classList.toggle('hidden', !show);
        const safeGet = (obj, ...keys) => {
            for (const k of keys)
                if (obj && Object.prototype.hasOwnProperty.call(obj, k)) return obj[k];
            return undefined;
        };

         function truncate(str, n) {
            return str && str.length > n ? str.slice(0, n) + '...' : (str || '');
        }

        function escapeHtml(str) {
            if (!str) return '';
            return String(str).replace(/[&<>"']/g, s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[s]));
        }


        async function loadCategories() {
            showSpinner(true);
            try {
                const res = await fetch(ENDPOINTS.categories);
                const json = await res.json();
                categories = safeGet(json, 'data')?.data || safeGet(json, 'data') || safeGet(json, 'categories') || [];
                renderCategories(categories);
                if (categories.length) {
                    const firstId = categories[0].id || categories[0].category_id;
                    loadCategoryProducts(firstId);
                } else {
                    loadPlants();
                }
            } catch (e) {
                console.error(e);
                categoryListEl.innerHTML = `<div class="text-red-600">Failed to load categories</div>`;
            } finally {
                showSpinner(false);
            }
        }

        function renderCategories(list) {
            categoryListEl.innerHTML = '';
            const btnAll = createCategoryButton('All Plants', () => {
                setActiveCategoryButton(null);
                loadPlants();
            });
            categoryListEl.appendChild(btnAll);
            list.forEach(cat => {
                const label = cat.name || cat.category_name || cat.title || 'Category';
                const id = cat.id || cat.category_id;
                const btn = createCategoryButton(label, () => {
                    setActiveCategoryButton(btn);
                    loadCategoryProducts(id);
                });
                btn.dataset.id = id ?? '';
                categoryListEl.appendChild(btn);
            });
            const firstBtn = categoryListEl.querySelector('button');
            if (firstBtn) setActiveCategoryButton(firstBtn);
        }

        function createCategoryButton(label, onClick) {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'category-button text-left px-3 py-2 rounded-md bg-slate-50 font-medium';
            btn.textContent = label;
            btn.addEventListener('click', onClick);
            return btn;
        }

        function setActiveCategoryButton(btn) {
            categoryListEl.querySelectorAll('button').forEach(b => {
                b.classList.remove('bg-[var(--green)]', 'text-white');
                b.classList.add('bg-slate-50', 'text-[var(--dark-text)]');
            });
            if (btn) {
                btn.classList.remove('bg-slate-50', 'text-[var(--dark-text)]');
                btn.classList.add('bg-[var(--green)]', 'text-white');
            } else {
                const first = categoryListEl.querySelector('button');
                if (first) {
                    first.classList.remove('bg-slate-50', 'text-[var(--dark-text)]');
                    first.classList.add('bg-[var(--green)]', 'text-white');
                }
            }
        }

    
        async function loadPlants() {
            showSpinner(true);
            productsEl.innerHTML = '';
            try {
                const res = await fetch(ENDPOINTS.plants);
                const json = await res.json();
                const list = safeGet(json, 'data')?.data || safeGet(json, 'data') || safeGet(json, 'plants') || [];
                renderProducts(list);
            } catch (e) {
                console.error(e);
                productsEl.innerHTML = `<div class="text-red-600">Failed to load plants</div>`;
            } finally {
                showSpinner(false);
            }
        }

        
        async function loadCategoryProducts(id) {
            if (!id) return loadPlants();
            showSpinner(true);
            productsEl.innerHTML = '';
            try {
                const res = await fetch(ENDPOINTS.category(id));
                const json = await res.json();
                const list = safeGet(json, 'data')?.data || safeGet(json, 'data') || safeGet(json, 'plants') || [];
                renderProducts(list);
            } catch (e) {
                console.error(e);
                productsEl.innerHTML = `<div class="text-red-600">Failed to load products</div>`;
            } finally {
                showSpinner(false);
            }
        }

        
        function renderProducts(list) {
            productsEl.innerHTML = '';
            if (!list || list.length === 0) {
                productsEl.innerHTML = `<div class="text-slate-600">No products found</div>`;
                return;
            }
            list.forEach(item => {
                const id = item.id || item.plant_id || item._id || item.plantId || '';
                const name = item.name || item.plant_name || item.title || 'Plant';
                const description = (item.description || item.short_description || item.long_description || '').toString();
                const img = item.image || item.thumbnail || 'https://via.placeholder.com/800x480?text=No+Image';
                const category = item.category || item.category_name || 'General';
                const priceRaw = item.price || item.price_cost || item.cost;
                const price = priceRaw ? Number(priceRaw) : Number((Math.random() * 20 + 5).toFixed(2));

                const card = document.createElement('article');
                card.className = 'product-card p-4 flex flex-col h-full';

                card.innerHTML = `
                    <div class="flex-1">
                        <img src="${escapeHtml(img)}" alt="${escapeHtml(name)}" class="w-full h-40 object-cover rounded-md">
                        <h3 class="mt-3 text-base font-semibold text-[var(--dark-text)] cursor-pointer">${escapeHtml(name)}</h3>
                        <p class="text-xs text-slate-600 mt-1 line-clamp-4">${escapeHtml(truncate(description, 120))}</p>
                        <div class="meta mt-3 flex items-center justify-between">
                            <span class="tag inline-block text-xs font-semibold px-2 py-0.5 rounded-full bg-green-50 text-[var(--green)]">${escapeHtml(category)}</span>
                            <span class="price font-bold text-sm">${fmt(price)}</span>
                        </div>
                    </div>
                    <div class="actions mt-4">
                        <button class="add-to-cart-btn">Add to Cart</button>
                    </div>
                `;

                const addBtn = card.querySelector('.add-to-cart-btn');
                addBtn.addEventListener('click', () => addToCart({ id, name, price, img, description, category }));

                const nameEl = card.querySelector('h3');
                nameEl.addEventListener('click', () => openDetail(id, item));

                productsEl.appendChild(card);
            });
        }

        
        async function openDetail(id, fallbackItem) {
            modalEl.classList.remove('hidden');
            modalEl.classList.add('backdrop-show');
            modalContentEl.innerHTML = `<div class="text-slate-600">Loading details...</div>`;
            try {
                if (id) {
                    const res = await fetch(ENDPOINTS.plant(id));
                    const json = await res.json();
                    const data = safeGet(json, 'data') || safeGet(json, 'data')?.data || fallbackItem || {};
                    showProductModal(data);
                } else {
                    showProductModal(fallbackItem || {});
                }
            } catch (e) {
                console.error(e);
                showProductModal(fallbackItem || {});
            }
        }

        function showProductModal(data) {
            const name = data.name || data.plant_name || data.title || 'Plant';
            const img = data.image || data.thumbnail || 'https://via.placeholder.com/800x480?text=No+Image';
            const description = data.description || data.long_description || data.short_description || 'No description available.';
            const category = data.category || data.category_name || 'General';
            const priceRaw = data.price || data.price_cost || data.cost;
            const price = priceRaw ? Number(priceRaw) : Number((Math.random() * 20 + 5).toFixed(2));

            modalContentEl.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <img src="${escapeHtml(img)}" alt="${escapeHtml(name)}" class="w-full h-56 object-cover rounded-md">
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-[var(--dark-text)]">${escapeHtml(name)}</h3>
                        <p class="text-sm text-slate-700 mt-3">${escapeHtml(description)}</p>
                        <div class="mt-4">
                            <div class="text-sm"><strong>Category:</strong> ${escapeHtml(category)}</div>
                            <div class="text-lg font-bold mt-2">Price: ${fmt(price)}</div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button class="bg-[var(--green)] text-white px-4 py-2 rounded-md">Add to Cart</button>
                            <button class="bg-slate-100 px-4 py-2 rounded-md text-red-600 font-semibold" id="modalDetailCloseBtn">Close</button>
                        </div>
                    </div>
                </div>
            `;

            modalContentEl.querySelector('button.bg-[var(--green)]').addEventListener('click', () => {
                addToCart({ id: data.id || data.plant_id || '', name, price, img, description, category });
                closeModal();
            });
            document.getElementById('modalDetailCloseBtn').addEventListener('click', closeModal);
        }

        function closeModal() {
            modalEl.classList.add('hidden');
            modalEl.classList.remove('backdrop-show');
            modalContentEl.innerHTML = '';
        }

    
        function addToCart(item) {
            cart.push(item);
            renderCart();
        }

        function removeFromCart(idx) {
            cart.splice(idx, 1);
            renderCart();
        }

        function renderCart() {
            cartListDesktopEl.innerHTML = '';
            cartListMobileEl.innerHTML = '';

            if (cart.length === 0) {
                const noItemsText = `<div class="text-slate-500">No items in cart</div>`;
                cartListDesktopEl.innerHTML = noItemsText;
                cartListMobileEl.innerHTML = noItemsText;
            } else {
                cart.forEach((it, idx) => {
                    const rowHtml = `<div class="cart-item flex items-center justify-between py-2 border-b last:border-b-0">
                                     <div class="max-w-[60%] text-sm cursor-pointer" data-item-idx="${idx}">${escapeHtml(it.name)}</div>
                                     <div class="text-sm font-semibold">${fmt(it.price)} <button class="ml-2 text-red-500" data-idx="${idx}">❌</button></div>
                                   </div>`;
                    cartListDesktopEl.innerHTML += rowHtml;
                    cartListMobileEl.innerHTML += rowHtml;
                });
            }

            const attachListeners = (container) => {
                container.querySelectorAll('button[data-idx]').forEach(btn => {
                    btn.addEventListener('click', e => removeFromCart(Number(btn.dataset.idx)));
                });
                container.querySelectorAll('[data-item-idx]').forEach(itemEl => {
                    itemEl.addEventListener('click', e => {
                        const idx = Number(itemEl.dataset.itemIdx);
                        if (cart[idx]) {
                            openDetail(cart[idx].id, cart[idx]);
                        }
                    });
                });
            };
            attachListeners(cartListDesktopEl);
            attachListeners(cartListMobileEl);

            const total = cart.reduce((s, i) => s + Number(i.price || 0), 0);
            const totalText = fmt(total);

            cartCountDesktopEl.textContent = `(${cart.length})`;
            totalDesktopEl.textContent = totalText;
            cartCountMobileEl.textContent = `(${cart.length})`;
            totalMobileEl.textContent = totalText;
        }
        
        donateBtn?.addEventListener('click', () => {
            const name = document.getElementById('donorName')?.value.trim();
            const email = document.getElementById('donorEmail')?.value.trim();
            const qty = Number(document.getElementById('donorQty')?.value) || 0;
            if (!name || !email || qty === 0) {
                alert('Please provide name, email and select number of trees');
                return;
            }
            alert(`Thank you ${name}!\nYou selected ${qty} trees. We will contact you at ${email}.`);
            document.getElementById('donorName').value = '';
            document.getElementById('donorEmail').value = '';
            document.getElementById('donorQty').value = 0;
        });

        mobileMenuBtn?.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        
        closeModalBtn?.addEventListener('click', closeModal);
        document.getElementById('modal')?.addEventListener('click', (e) => {
            if (e.target === document.getElementById('modal')) closeModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        
        closeFixedCartBtn?.addEventListener('click', () => {
            fixedCartEl.style.display = 'none';
        });

    
        document.addEventListener('DOMContentLoaded', () => {
            loadCategories();
        });


    </script>

</body>

</html>